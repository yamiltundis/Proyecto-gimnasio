
generator client {
  provider   = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Usuario {
  id     Int    @id @default(autoincrement())
  nombre String
  apellido String
  dni Int
  fechaNacimiento DateTime
  email  String @unique
  foto String
  rol String
  password String @default("")
  pagos Pago[]
  membreciasActivas MembreciaActiva[]
  reservas Reserva[]
  asistenciasClases AsistenciaClase[]
  asistencias Asistencia[]
}

model TipoClase {
  id Int @id @default(autoincrement())
  nombre String
  clasesEspecificas ClaseEspecifica[]
}

model ClaseEspecifica {
  id Int @id @default(autoincrement())
  diaHora DateTime
  cantmax Int
  tipoClaseId Int
  tipoClase TipoClase @relation(fields: [tipoClaseId], references: [id])
  reservas Reserva[]
  asistenciasClase AsistenciaClase[]
}

model TipoMembrecia {
  id Int @id @default(autoincrement())
  nombre String
  dias Int
  listasPrecios ListaPrecio[]
  pagos Pago[]
}

model ListaPrecio {
  id Int @id @default(autoincrement())
  monto Int
  diaInicial DateTime
  tipoMembreciaId Int
  tipoMembrecia TipoMembrecia @relation(fields: [tipoMembreciaId], references: [id])
}

model Pago {
  id Int @id @default(autoincrement())
  monto Int
  fecha DateTime
  clienteId Int
  cliente Usuario @relation(fields: [clienteId], references: [id])
  tipoMembreciaId Int
  tipoMembrecia TipoMembrecia @relation(fields: [tipoMembreciaId], references: [id])
  membreciasActivas MembreciaActiva[]
}

model MembreciaActiva {
  Id Int @id @default(autoincrement())
  fechaInicio DateTime
  fechaFin DateTime
  clienteId Int
  cliente Usuario @relation(fields: [clienteId], references: [id])
  pagoId Int
  pago Pago @relation(fields: [pagoId], references: [id])
}

model Reserva {
  id Int @id @default(autoincrement())
  fechaReserva DateTime
  estado String
  clienteId Int
  cliente Usuario @relation(fields: [clienteId], references: [id])
  claseEspecificaId Int
  claseEspecifica ClaseEspecifica @relation(fields: [claseEspecificaId], references: [id])
  asistencia      AsistenciaClase? @relation("ReservaAsistencia")
}

model AsistenciaClase {
  id Int @id @default(autoincrement())
  horacheckin DateTime
  clienteId Int
  cliente Usuario @relation(fields: [clienteId], references: [id])
  claseEspecificaId Int
  claseEspecifica ClaseEspecifica @relation(fields: [claseEspecificaId], references: [id])
  reserva     Reserva?  @relation("ReservaAsistencia",fields: [reservaId], references: [id])
  reservaId   Int?      @unique
}

model Asistencia {
  id Int @id @default(autoincrement())
  fechaHora DateTime
  clienteId Int
  cliente Usuario @relation(fields: [clienteId], references: [id])
}